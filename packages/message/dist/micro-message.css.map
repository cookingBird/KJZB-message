{"version":3,"file":"micro-message.css","mappings":"AAqFC,mBAEC,WAAY,CADZ,UAED","sources":["webpack://@gislife/micro-message/./src/microApp.vue"],"sourcesContent":["<template>\r\n<iframe\r\n\tref=\"iframe\"\r\n\t:data-app-code=\"microAppCode\"\r\n\t:src=\"buildSrc(src)\"\r\n\t:id=\"id\"\r\n\tclass=\"gislife-micro-app\"\r\n\ttitle=\"\"\r\n>\r\n</iframe>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport {\r\n\tonMounted,\r\n\tonBeforeUnmount,\r\n\tcomputed,\r\n\tref,\r\n\tnextTick,\r\n\twatch,\r\n} from \"vue\";\r\nimport { ensureInstance } from \"./util\";\r\nimport { connector } from './index';\r\nimport * as Qs from 'qs';\r\ndefineOptions({\r\n\tname: 'MicroApp',\r\n})\r\n\r\nconst props = defineProps<{\r\n\tsrc: string,\r\n\tmicroAppCode: string,\r\n\tstate?: Record<string, any>,\r\n\tquery?: Record<string, any>,\r\n}>()\r\nconst emits = defineEmits([]);\r\n\r\nconst id = computed(() => ('gislife-' + props.microAppCode));\r\nconst passiveState = computed(() => JSON.parse(JSON.stringify(props.state || {})));\r\nconst buildSrc = computed(() => (src: string) => {\r\n\tconst query = Qs.stringify(props.query || {});\r\n\tif (src.indexOf('?') === -1) {\r\n\t\treturn src + '?' + query + '&microAppCode=' + props.microAppCode;\r\n\t} else {\r\n\t\treturn src + '&' + query + '&microAppCode=' + props.microAppCode;\r\n\t}\r\n})\r\n\r\nconst iframe = ref<HTMLElement>(null);\r\nonMounted(async () => {\r\n\tensureInstance(() => iframe.value)\r\n\t\t.then((dom) => {\r\n\t\t\tdom.addEventListener('load', () => {\r\n\t\t\t\temits('load', true);\r\n\t\t\t\tconnector.$send({\r\n\t\t\t\t\ttarget: props.microAppCode,\r\n\t\t\t\t\ttype: 'setState',\r\n\t\t\t\t\tdata: passiveState.value\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t})\r\n});\r\n\r\n\r\nonBeforeUnmount(watch(passiveState, (val) => {\r\n\tconnector.$send({\r\n\t\ttarget: props.microAppCode,\r\n\t\ttype: 'setState',\r\n\t\tdata: val\r\n\t});\r\n}))\r\n\r\nonMounted(() => {\r\n\tconst cancel = connector.$on(({ msg }) => {\r\n\t\temits(msg.type, msg.data)\r\n\t});\r\n\tonBeforeUnmount(cancel);\r\n})\r\n\r\nonBeforeUnmount(() => {\r\n\tconnector.unRegisterApp(props.microAppCode);\r\n})\r\n\r\n</script>\r\n\r\n<style lang=\"css\">\r\n\t.gislife-micro-app {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n</style>\r\n"],"names":[],"sourceRoot":""}