{"version":3,"file":"micro-message.css","mappings":"AAyFC,mBAEC,WAAY,CADZ,UAED","sources":["webpack://@gislife/micro-message/./src/microApp.vue"],"sourcesContent":["<template>\r\n<iframe\r\n\t:data-app-code=\"microAppCode\"\r\n\t:src=\"buildSrc(src)\"\r\n\t:id=\"id\"\r\n\tclass=\"gislife-micro-app\"\r\n\tref=\"window\"\r\n\ttitle\r\n>\r\n</iframe>\r\n</template>\r\n\r\n<script>\r\n\timport { pickFileds, deepCloneBaseType } from './util'\r\n\r\n\texport default {\r\n\t\tname: \"microApp\",\r\n\t\tinheritAttrs: false,\r\n\t\tprops: {\r\n\t\t\tsrc: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\trequired: true\r\n\t\t\t},\r\n\t\t\tmicroAppCode: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\trequired: true,\r\n\t\t\t},\r\n\t\t\tstate: {\r\n\t\t\t\ttype: Object,\r\n\t\t\t\tdefault: () => ({})\r\n\t\t\t},\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tid() {\r\n\t\t\t\treturn 'gislife-' + this.microAppCode\r\n\t\t\t},\r\n\t\t\tpassiveState() {\r\n\t\t\t\tconst res = {\r\n\t\t\t\t\troute: pickFileds(\r\n\t\t\t\t\t\tthis.$route,\r\n\t\t\t\t\t\t['fullPath', 'hash', 'meta', 'name', 'params', 'path', 'query']\r\n\t\t\t\t\t),\r\n\t\t\t\t\t...deepCloneBaseType(this.state)\r\n\t\t\t\t}\r\n\t\t\t\treturn res\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tpassiveState(val, oldVal) {\r\n\t\t\t\tif (val != oldVal) {\r\n\t\t\t\t\tthis.$connector.$send({\r\n\t\t\t\t\t\ttarget: this.microAppCode,\r\n\t\t\t\t\t\ttype: 'setState',\r\n\t\t\t\t\t\tdata: this.passiveState\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tconst loadCancel = this.$refs.window?.addEventListener('load', () => {\r\n\t\t\t\tthis.$connector.$send({\r\n\t\t\t\t\ttarget: this.microAppCode,\r\n\t\t\t\t\ttype: 'setState',\r\n\t\t\t\t\tdata: val\r\n\t\t\t\t})\r\n\t\t\t});\r\n\r\n\t\t\tthis.$connector.$on(this, ({ msg }) => {\r\n\t\t\t\tconst emitType = msg.type;\r\n\t\t\t\tconst listener = this.$listeners[emitType];\r\n\t\t\t\tif (listener) {\r\n\t\t\t\t\tlistener(msg.data)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.$on('hook:beforeDestory', loadCancel)\r\n\t\t},\r\n\t\tdestroyed() {\r\n\t\t\tthis.$connector.unRegisterApp(this.microAppCode)\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tbuildSrc(src) {\r\n\t\t\t\tconst hasParam = src.includes('?');\r\n\t\t\t\treturn src + (hasParam ? '&' : '?') + 'microAppCode=' + this.microAppCode\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"css\">\r\n\t.gislife-micro-app {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n</style>\r\n"],"names":[],"sourceRoot":""}